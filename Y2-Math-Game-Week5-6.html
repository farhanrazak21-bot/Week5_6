<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Y2 Math — Week 5 & 6 Interactive</title>
<style>
  :root{
    --bg1: #fff9c4; /* warm bright */
    --panel: #ffffff;
    --muted: #6b7280;
    --accent: #ff7a7a;
    --accent2: #60a5fa;
    --ok: #16a34a;
    --shadow: 0 6px 18px rgba(0,0,0,0.12);
    --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:var(--font);background:linear-gradient(135deg,var(--bg1) 0%, #d7fbe8 100%);color:#0f172a}
  .app{max-width:1000px;margin:18px auto;padding:16px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .sub{color:var(--muted);font-size:13px}
  .controls{display:flex;gap:10px;align-items:center}
  .panel{background:var(--panel);padding:12px;border-radius:12px;box-shadow:var(--shadow)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button{background:var(--accent);border:0;color:white;padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,0.08)}
  button.ghost{background:transparent;border:2px solid rgba(15,23,42,0.06);color:var(--accent)}
  button.secondary{background:transparent;border:2px solid var(--accent2);color:var(--accent2)}
  input,select{padding:8px;border-radius:8px;border:1px solid #e6edf3}
  .grid{display:grid;gap:10px}
  .two{grid-template-columns:1fr 320px}
  @media(max-width:880px){.two{grid-template-columns:1fr}}
  .big{font-weight:700;font-size:16px}
  .hint{color:var(--muted);font-size:13px}
  .score{font-weight:700;color:#0b945e}
  .stars{font-size:18px;color:gold}
  .progress{height:12px;background:#f3f4f6;border-radius:999px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#34d399);width:0%}
  .option{background:#f8fafc;padding:10px;border-radius:10px;border:1px dashed #e6edf3;cursor:pointer;text-align:center}
  .option.selected{background:#60a5fa;color:white;border:none}
  .option.correct{background:var(--ok);color:white}
  .canvas-wrap{background:#fff;padding:8px;border-radius:10px;border:1px dashed #e6edf3}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:12px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Y2 Math — Week 5 & 6 Interactive</h1>
      <div class="sub">Fact families • Complements & Place value grids • Dotty technique • Islamic & Eco integration</div>
    </div>
    <div class="controls">
      <div class="score panel">Score: <span id="score">0</span> pts</div>
      <div class="stars panel">Stars: <span id="stars">☆☆☆</span></div>
      <button id="restart" class="ghost">Restart</button>
    </div>
  </header>

  <main style="margin-top:14px" class="grid two">
    <section class="panel" id="left">
      <div class="big">Activity</div>
      <div style="margin-top:8px" id="taskArea"></div>
      <div style="margin-top:12px" class="row">
        <button id="checkBtn">Check Answer</button>
        <button id="nextBtn" class="secondary">Next</button>
        <button id="hintBtn" class="ghost">Hint</button>
      </div>
      <div style="margin-top:10px" class="progress"><i id="prog"></i></div>
      <div id="feedback" style="margin-top:10px" class="small"></div>
    </section>

    <aside class="panel">
      <div class="big">Teacher Prompts & Controls</div>
      <div class="hint" style="margin-top:8px">Use the controls to guide class — click "Next" when the group finishes. Press "Hint" to help students. Sketch area allows digital drawing for place-value / dotty tasks.</div>

      <div style="margin-top:12px">
        <label for="mode" class="small">Choose Activity:</label><br/>
        <select id="mode" style="width:100%;margin-top:6px">
          <option value="factfamily">Fact Family House (Lesson 1)</option>
          <option value="complements">Complements of 20 & multiples (Lesson 2)</option>
          <option value="placegrid">Place Value Grid Addition (no regroup)</option>
          <option value="dotty">Dotty Technique Addition</option>
          <option value="sketch">Sketch / Visual (draw number bonds)</option>
        </select>
      </div>

      <div style="margin-top:12px">
        <div class="small">Mini-controls</div>
        <div style="margin-top:6px" class="row">
          <button id="playDua" class="ghost">Play Dua (short)</button>
          <button id="toggleSound" class="ghost">Sound: ON</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="big">Integration</div>
        <div class="small" style="margin-top:6px">Islamic: Hikmah, Amanah, honesty and discipline in learning. Eco: balance in ecosystems — complements mirror interdependence.</div>
      </div>
    </aside>
  </main>

  <footer>
    Tip: Start with Assalamualaikum and a short dua. Relate complements to balance in nature and to Islamic values of responsibility.
  </footer>
</div>

<script>
/* Y2 Week5&6 Interactive Game
   - Waits for DOMContentLoaded to avoid null listeners.
   - Prevents repeated scoring abuse by disabling Check until Next.
   - Includes sketch canvas for drawing number bonds / place value representations.
*/

document.addEventListener('DOMContentLoaded', ()=>{

  // Elements
  const modeSel = document.getElementById('mode');
  const taskArea = document.getElementById('taskArea');
  const checkBtn = document.getElementById('checkBtn');
  const nextBtn = document.getElementById('nextBtn');
  const hintBtn = document.getElementById('hintBtn');
  const restartBtn = document.getElementById('restart');
  const scoreEl = document.getElementById('score');
  const starsEl = document.getElementById('stars');
  const prog = document.getElementById('prog');
  const feedback = document.getElementById('feedback');
  const playDua = document.getElementById('playDua');
  const toggleSound = document.getElementById('toggleSound');

  // State
  let score = 0, stars = 0;
  let stepProgress = 0; // 0..100
  let currentTask = null; // object for checking
  let soundOn = true;

  // WebAudio beep for feedback
  const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  function beep(freq=880, duration=0.12){
    if(!soundOn) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine'; o.frequency.value = freq;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.0001,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.01);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    o.stop(audioCtx.currentTime + duration + 0.02);
  }

  // Utilities
  function setScore(n){
    score = n; scoreEl.textContent = score;
    updateStars();
  }
  function addScore(n){
    score = Math.max(0, score + n); scoreEl.textContent = score;
    updateStars();
  }
  function updateStars(){
    // simple threshold stars
    stars = score >= 40 ? 3 : score >= 26 ? 2 : score >= 12 ? 1 : 0;
    starsEl.textContent = '★'.repeat(stars) + '☆'.repeat(3-stars);
  }
  function setProgress(p){
    stepProgress = Math.max(0, Math.min(100, p));
    prog.style.width = stepProgress + '%';
  }
  function lockCheck(){
    checkBtn.disabled = true;
  }
  function unlockCheck(){
    checkBtn.disabled = false;
  }
  function info(msg){
    feedback.textContent = msg;
  }

  // Restart
  function resetAll(){
    setScore(0); setProgress(0); info('');
    currentTask = null;
    renderMode(modeSel.value);
  }

  // Mode renderers
  function renderMode(mode){
    taskArea.innerHTML = '';
    unlockCheck(); nextBtn.disabled = false; info('');
    if(mode === 'factfamily') renderFactFamily();
    else if(mode === 'complements') renderComplements();
    else if(mode === 'placegrid') renderPlaceGrid();
    else if(mode === 'dotty') renderDotty();
    else if(mode === 'sketch') renderSketchNumberBond();
  }

  // 1) Fact Family House
  function renderFactFamily(){
    const intro = document.createElement('div');
    intro.innerHTML = `<div class="big">Fact Family House</div><div class="hint">Given an addition fact, write the related subtraction facts (fact family). Use numbers within 20.</div>`;
    taskArea.appendChild(intro);

    // choose total and parts
    const total = 5 + Math.floor(Math.random()*15); // 5..19
    const part = 1 + Math.floor(Math.random()*(total-1));
    const other = total - part;

    const house = document.createElement('div');
    house.innerHTML = `<div style="margin-top:8px">Roof (total): <b>${total}</b></div><div style="margin-top:6px">Windows (parts): <input id='p1' type='number' style='width:80px' value='${part}'/> and <input id='p2' type='number' style='width:80px' value='${other}'/></div>
      <div style='margin-top:8px'>Write the 4 sentences:</div><div style='margin-top:6px'><textarea id='ff' rows='4' style='width:100%' placeholder='e.g., 8 + 2 = 10, 2 + 8 = 10, 10 - 8 = 2, 10 - 2 = 8'></textarea></div>`;
    taskArea.appendChild(house);

    currentTask = {type:'factfamily', total: total, parts: [part, other]};

    checkBtn.onclick = ()=>{
      const t = currentTask.total;
      const p1 = Number(document.getElementById('p1').value);
      const p2 = Number(document.getElementById('p2').value);
      const txt = (document.getElementById('ff').value||'').replace(/\s+/g,'');
      // basic validation: numbers present and correct family
      const okParts = (p1 + p2 === t) || (p2 + p1 === t);
      const hasAdd1 = new RegExp(`${p1}\\+${p2}=${t}`).test(txt) || new RegExp(`${p2}\\+${p1}=${t}`).test(txt);
      const hasSub1 = new RegExp(`${t}-${p1}=${p2}`).test(txt) || new RegExp(`${t}-${p2}=${p1}`).test(txt);
      if(!okParts){ addScore(-1); info('Parts do not add to roof total. Check parts. (-1pt)'); return; }
      if(hasAdd1 && hasSub1){ addScore(8); info('Good fact family! +8 pts'); beep(880,0.08); setProgress(stepProgress+25); lockCheck(); }
      else{ addScore(-1); info('Check your sentences — include both addition and subtraction facts. (-1pt)'); }
    };

    hintBtn.onclick = ()=>{ info('Hint: Fact family contains two addition and two subtraction sentences. Roof = total.'); addScore(-1); };

  }

  // 2) Complements to 20 and multiples
  function renderComplements(){
    const intro = document.createElement('div');
    intro.innerHTML = `<div class="big">Complements</div><div class="hint">Find complements to 20 or to multiples of 10 (e.g., complements to 50 or 100). Type your answer.</div>`;
    taskArea.appendChild(intro);

    // choose target (20 or 100) and number
    const target = Math.random()<0.6?20:100;
    const n = Math.floor(Math.random()*(target-1))+1;
    const input = document.createElement('input'); input.type='number'; input.id='comp_in'; input.style.width='120px';
    const q = document.createElement('div'); q.style.marginTop='8px'; q.innerHTML = `Find the complement of <b>${n}</b> to make <b>${target}</b>: `; q.appendChild(input);
    taskArea.appendChild(q);

    currentTask = {type:'complements', target:target, n:n};

    checkBtn.onclick = ()=>{
      const val = Number(document.getElementById('comp_in').value);
      if(val + currentTask.n === currentTask.target){ addScore(5); info('Correct complement! +5 pts'); beep(880,0.08); setProgress(stepProgress+25); lockCheck(); }
      else{ addScore(-1); info('Not correct — check subtraction: target - n. (-1pt)'); }
    };

    hintBtn.onclick = ()=>{ info('Hint: Complement = target minus the given number.'); addScore(-1); };
  }

  // 3) Place value grid addition (no regrouping)
  function renderPlaceGrid(){
    const intro = document.createElement('div');
    intro.innerHTML = `<div class="big">Place Value Grid — Add without regrouping</div><div class="hint">Add a 1- or 2-digit number to a 2-digit number (no regrouping). Use the grid or type the answer.</div>`;
    taskArea.appendChild(intro);

    // pick base 2-digit and addend such that ones sum < 10
    let a = 10 + Math.floor(Math.random()*9); // 10..18
    let b = Math.floor(Math.random()*9)+1; // 1..9
    while( (a%10) + (b%10) >=10 ){ a = 10 + Math.floor(Math.random()*9); b = Math.floor(Math.random()*9)+1; }
    const grid = document.createElement('div'); grid.style.marginTop='8px';
    grid.innerHTML = `<div>Grid: Tens | Ones</div><div style="margin-top:6px"><input id='g_a_t' style='width:60px' value='${Math.floor(a/10)}'/> <input id='g_a_o' style='width:60px' value='${a%10}'/>  +  <input id='g_b_t' style='width:60px' value='${Math.floor(b/10)}'/> <input id='g_b_o' style='width:60px' value='${b%10}'/></div>
      <div style='margin-top:8px'>Answer (type): <input id='place_ans' style='width:120px' placeholder='e.g., 28'/></div>`;
    taskArea.appendChild(grid);

    currentTask = {type:'placegrid', a:a, b:b};

    checkBtn.onclick = ()=>{
      const ans = Number(document.getElementById('place_ans').value);
      if(Number.isNaN(ans)){ info('Enter numeric answer.'); return; }
      if(ans === (currentTask.a + currentTask.b)){
        addScore(6); info('Correct addition! +6 pts'); beep(880,0.08); setProgress(stepProgress+25); lockCheck();
      } else { addScore(-1); info('Incorrect — check ones and tens separately. (-1pt)'); }
    };

    hintBtn.onclick = ()=>{ info('Hint: Add ones first (no regroup), then add tens.'); addScore(-1); };
  }

  // 4) Dotty technique — visual stickers (simulate by input)
  function renderDotty(){
    const intro = document.createElement('div');
    intro.innerHTML = `<div class="big">Dotty Technique</div><div class="hint">Use dots to represent ones/tens. Add without regrouping. Type the final answer.</div>`;
    taskArea.appendChild(intro);

    // generate numbers where ones sum < 10
    let a = 10 + Math.floor(Math.random()*8); let b = Math.floor(Math.random()*8)+1;
    while( (a%10) + (b%10) >= 10){ a = 10 + Math.floor(Math.random()*8); b = Math.floor(Math.random()*8)+1; }
    const q = document.createElement('div'); q.style.marginTop='8px'; q.innerHTML = `Add: <b>${a}</b> + <b>${b}</b> = <input id='dot_ans' style='width:120px'/>`;
    taskArea.appendChild(q);
    // small visual simulation
    const vis = document.createElement('div'); vis.className='row'; vis.style.marginTop='8px'; vis.innerHTML = `<div class='panel'>${'●'.repeat(a%10)} (ones of ${a})</div><div class='panel'>${'●'.repeat(b%10)} (ones of ${b})</div>`;
    taskArea.appendChild(vis);

    currentTask = {type:'dotty', a:a, b:b};

    checkBtn.onclick = ()=>{
      const v = Number(document.getElementById('dot_ans').value);
      if(v === currentTask.a + currentTask.b){ addScore(6); info('Well done — dotty method works! +6 pts'); beep(880,0.08); setProgress(stepProgress+25); lockCheck(); }
      else { addScore(-1); info('Try again — count dots for ones, then tens. (-1pt)'); }
    };

    hintBtn.onclick = ()=>{ info('Hint: Count dots (ones), ensure it is less than 10, then add tens.'); addScore(-1); };
  }

  // 5) Sketch: draw a number bond or ten-frame (teacher checks)
  function renderSketchNumberBond(){
    const intro = document.createElement('div');
    intro.innerHTML = `<div class="big">Sketch Number Bond / Ten-frame</div><div class="hint">Draw the number bond or ten-frame to show a fact family or complement. Use the canvas and press Check when finished.</div>`;
    taskArea.appendChild(intro);

    const promptChoices = ['Draw a fact family for 12','Draw a ten-frame for 8','Draw complements to 20 for 13'];
    const prompt = promptChoices[Math.floor(Math.random()*promptChoices.length)];
    const p = document.createElement('div'); p.textContent = 'Task: ' + prompt; p.style.marginTop='8px'; taskArea.appendChild(p);

    const canvasWrap = document.createElement('div'); canvasWrap.className='canvas-wrap'; canvasWrap.style.marginTop='8px';
    const canvas = document.createElement('canvas'); canvas.width = 420; canvas.height = 240; canvas.style.touchAction='none'; canvas.style.borderRadius='8px'; canvas.style.background='#ffffff';
    canvasWrap.appendChild(canvas);
    const row = document.createElement('div'); row.className='row'; row.style.marginTop='8px';
    const clearBtn = document.createElement('button'); clearBtn.textContent='Clear';
    const doneNote = document.createElement('div'); doneNote.className='small'; doneNote.textContent='When finished press Check Answer.';
    row.appendChild(clearBtn); row.appendChild(doneNote);
    taskArea.appendChild(canvasWrap); taskArea.appendChild(row);

    // drawing logic
    const ctx = canvas.getContext('2d');
    ctx.lineWidth = 3; ctx.lineCap='round'; ctx.strokeStyle='#0f172a';
    let drawing=false;
    function startDraw(e){ drawing=true; ctx.beginPath(); const r = canvas.getBoundingClientRect(); const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left; const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top; ctx.moveTo(x,y); }
    function moveDraw(e){ if(!drawing) return; const r = canvas.getBoundingClientRect(); const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left; const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top; ctx.lineTo(x,y); ctx.stroke(); }
    function endDraw(){ drawing=false; ctx.closePath(); }
    canvas.addEventListener('pointerdown', startDraw);
    canvas.addEventListener('pointermove', moveDraw);
    window.addEventListener('pointerup', endDraw);
    clearBtn.onclick = ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); };

    currentTask = {type:'sketchnum', prompt: prompt, canvas: canvas};

    checkBtn.onclick = ()=>{
      const pixels = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let nonEmpty=false;
      for(let i=0;i<pixels.length;i+=4){ if(pixels[i+3] !== 0){ nonEmpty=true; break; } }
      if(!nonEmpty){ info('Please draw before checking.'); return; }
      addScore(6); info('Drawing submitted — teacher review. +6 pts'); beep(880,0.09); setProgress(stepProgress+20); lockCheck();
    };

    hintBtn.onclick = ()=>{ info('Hint: For number bonds, place the total at the top and parts below. For ten-frames, fill boxes up to the number.'); addScore(-1); };
  }

  // Hint button general
  hintBtn.addEventListener('click', ()=>{
    if(!currentTask){ info('Choose an activity first.'); return; }
    // handled in each renderer where needed
  });

  // Mode selector
  modeSel.addEventListener('change', ()=>{ renderMode(modeSel.value); });

  // Next button moves to new random task in same mode
  nextBtn.addEventListener('click', ()=>{ unlockCheck(); info(''); renderMode(modeSel.value); });

  // Restart
  restartBtn.addEventListener('click', ()=>{ if(confirm('Restart the game and reset score?')){ resetAll(); } });

  // Toggle sound
  toggleSound.addEventListener('click', ()=>{ soundOn = !soundOn; toggleSound.textContent = 'Sound: ' + (soundOn ? 'ON' : 'OFF'); });

  // Play a short dua audio using Web Speech
  playDua.addEventListener('click', ()=>{
    if('speechSynthesis' in window){
      const s = new SpeechSynthesisUtterance('Bismillah ar-Rahman ar-Raheem. O Allah, make our learning easy and blessed.');
      s.lang = 'en-US'; window.speechSynthesis.cancel(); window.speechSynthesis.speak(s);
    } else { alert('Dua: Bismillah ar-Rahman ar-Raheem — may Allah bless our learning.'); }
  });

  // initial render
  renderMode(modeSel.value);
  setScore(0);
  setProgress(0);
  info('Begin: say Assalamualaikum and start with a short dua. Click Check when ready.');

}); // DOM loaded
</script>
</body>
</html>
